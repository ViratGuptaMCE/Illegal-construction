<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="Sean Bradley" />
        <title>R3F: Controlling Camera from HTML Button Click</title>
        <meta name="description" content="React Three Fiber Tutorials by Sean Bradley : https://sbcode.net/react-three-fiber" />
        <style>
            html,
            body,
            #root {
                height: 100%;
                margin: 0;
                background: #000000;
            }
            #ui {
                position: absolute;
                top: 60px;
                left: 10px;
                width: 200px;
            }
            button {
                width: 200px;
                color: white;
                background-color: #303030;
                display: inline-block;
                font-weight: 400;
                text-align: center;
                white-space: nowrap;
                vertical-align: middle;
                cursor: pointer;
                border: 1px solid transparent;
                padding: 6px 12px;
                margin: 4px;
                font-size: 14px;
                border-radius: 4px;
                transition: opacity 0.3s;
            }
            button:hover {
                opacity: 0.7;
                background-color: #606060;
            }
        </style>
        <script type="importmap">
            {
                "imports": {
                    "react": "/react@18.3.1/react.mjs",
                    "react-dom/client": "/react-dom@18.3.1/client.mjs",
                    "@react-three/fiber": "/@react-three/fiber@8.16.8/fiber.mjs",
                    "@react-three/drei": "/@react-three/drei@9.107.0/drei-bundle.mjs",
                    "leva": "/leva@0.9.35/leva-bundle.mjs"
                }
            }
        </script>
        <script src="/@babel/standalone@7.25.3/babel.min.js"></script>
    </head>
    <body>
        <div id="root"></div>
        <script type="text/babel" data-type="module" data-presets="react">
            import React, { StrictMode, useRef } from 'react'
            import { createRoot } from 'react-dom/client'
            import { Stats, OrbitControls, useGLTF, Environment, PerspectiveCamera } from '@react-three/drei'
            import { Canvas, useFrame, useThree } from '@react-three/fiber'
            import { useControls, button } from 'leva'
            import JEASINGS from 'https://esm.sh/jeasings'

            const annotations = [
                {
                    title: 'View A',
                    description: '<p>Looking Down from Above</p>',
                    position: {
                        x: 0,
                        y: 25,
                        z: 0
                    },
                    lookAt: {
                        x: 1,
                        y: 0,
                        z: 0
                    }
                },
                {
                    title: 'View B',
                    position: {
                        x: 8,
                        y: -1.5,
                        z: 2
                    },
                    lookAt: {
                        x: 8.1,
                        y: -1.5,
                        z: 2
                    }
                },
                {
                    title: 'View C',
                    position: {
                        x: 5,
                        y: 5.11,
                        z: 12
                    },
                    lookAt: {
                        x: 5.1,
                        y: 0,
                        z: 12
                    }
                }
            ]

            function Arena({ controls }) {
                const { nodes, materials } = useGLTF('/models/collision-world.glb')

                return (
                    <group dispose={null}>
                        <mesh
                            geometry={nodes.Cube004.geometry}
                            material={materials['Material.001']}
                            position={[7.68, -5.59, 26.38]}
                            scale={0.5}
                            castShadow
                            receiveShadow
                            material-envMapIntensity={0.4}
                            onDoubleClick={({ point }) => {
                                new JEASINGS.JEasing(controls.current.target)
                                    .to(
                                        {
                                            x: point.x,
                                            y: point.y,
                                            z: point.z
                                        },
                                        1000
                                    )
                                    .easing(JEASINGS.Cubic.Out)
                                    .start()
                            }}
                        />
                    </group>
                )
            }

            function JEasings() {
                useFrame(() => {
                    JEASINGS.update()
                })
            }

            export default function App() {
                const controls = useRef()
                const camera = useRef()

                const buttons = annotations.map(({ title, lookAt, position }) => (
                    <button
                        onClick={() => {
                            new JEASINGS.JEasing(controls.current.target)
                                .to(
                                    {
                                        x: lookAt.x,
                                        y: lookAt.y,
                                        z: lookAt.z
                                    },
                                    2100
                                )
                                .easing(JEASINGS.Cubic.Out)
                                .start()

                            // change camera position
                            new JEASINGS.JEasing(camera.current.position)
                                .to(
                                    {
                                        x: position.x,
                                        y: position.y,
                                        z: position.z
                                    },
                                    2000
                                )
                                .easing(JEASINGS.Cubic.Out)
                                .start()
                        }}>
                        {title}
                    </button>
                ))

                return (
                    <>
                        <Canvas shadows>
                            <PerspectiveCamera ref={camera} makeDefault position={[10, 10, 10]} />
                            <directionalLight
                                intensity={1}
                                castShadow={true}
                                shadow-bias={-0.0002}
                                shadow-mapSize={[2048, 2048]}
                                position={[85.0, 80.0, 70.0]}
                                shadow-camera-left={-30}
                                shadow-camera-right={30}
                                shadow-camera-top={30}
                                shadow-camera-bottom={-30}
                            />
                            <Environment files="/img/drakensberg_solitary_mountain_1k.hdr" background />
                            <OrbitControls ref={controls} target={[0, 1, 0]} />
                            <Arena controls={controls} />
                            <JEasings />
                            <Stats />
                        </Canvas>
                        <div id="ui">{buttons}</div>
                    </>
                )
            }

            createRoot(document.getElementById('root')).render(
                <StrictMode>
                    <App />
                </StrictMode>
            )

            useGLTF.preload('/models/collision-world.glb')
        </script>
    </body>
</html>